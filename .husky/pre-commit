#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

for ws in $(git diff --name-only --cached | grep -oE 'packages/([^/]+)' | uniq); do
  pnpm --filter="./${ws}" lint:fix
done

pnpm i
git add pnpm-lock.yaml

if $(git diff --name-only | grep -q '^pnpm-lock.yaml$'); then
  git add pnpm-lock.yaml
  git commit -m 'chore: update lockfile'
fi

